"use strict";function Compressor(e,n){return this instanceof Compressor?(TreeTransformer.call(this,this.before,this.after),this.options=defaults(e,{sequences:!n,properties:!n,dead_code:!n,drop_debugger:!n,unsafe:!1,unsafe_comps:!1,conditionals:!n,comparisons:!n,evaluate:!n,booleans:!n,loops:!n,unused:!n,hoist_funs:!n,hoist_vars:!1,if_return:!n,join_vars:!n,cascade:!n,side_effects:!n,screw_ie8:!1,warnings:!0,global_defs:{}},!0),void 0):new Compressor(e,n)}Compressor.prototype=new TreeTransformer,merge(Compressor.prototype,{option:function(e){return this.options[e]},warn:function(){this.options.warnings&&AST_Node.warn.apply(AST_Node,arguments)},before:function(e,n){if(e._squeezed)return e;if(e instanceof AST_Scope&&(e.drop_unused(this),e=e.hoist_declarations(this)),n(e,this),e=e.optimize(this),e instanceof AST_Scope){var t=this.options.warnings;this.options.warnings=!1,e.drop_unused(this),this.options.warnings=t}return e._squeezed=!0,e}}),function(){function e(e,n){e.DEFMETHOD("optimize",function(e){var t=this;if(t._optimized)return t;var i=n(t,e);return i._optimized=!0,i===t?i:i.transform(e)})}function n(e,n,t){return t||(t={}),n&&(t.start||(t.start=n.start),t.end||(t.end=n.end)),new e(t)}function t(e,t,i){if(t instanceof AST_Node)return t.transform(e);switch(typeof t){case"string":return n(AST_String,i,{value:t}).optimize(e);case"number":return n(isNaN(t)?AST_NaN:AST_Number,i,{value:t}).optimize(e);case"boolean":return n(t?AST_True:AST_False,i).optimize(e);case"undefined":return n(AST_Undefined,i).optimize(e);default:if(null===t)return n(AST_Null,i).optimize(e);if(t instanceof RegExp)return n(AST_RegExp,i).optimize(e);throw new Error(string_template("Can't handle constant of type: {type}",{type:typeof t}))}}function i(e){if(null===e)return[];if(e instanceof AST_BlockStatement)return e.body;if(e instanceof AST_EmptyStatement)return[];if(e instanceof AST_Statement)return[e];throw new Error("Can't convert thing to statement array")}function r(e){return null===e?!0:e instanceof AST_EmptyStatement?!0:e instanceof AST_BlockStatement?0==e.body.length:!1}function o(e){return e instanceof AST_Switch?e:e instanceof AST_For||e instanceof AST_ForIn||e instanceof AST_DWLoop?e.body instanceof AST_BlockStatement?e.body:e:e}function a(e,t){function r(e){var n=[];return e.reduce(function(e,t){return t instanceof AST_BlockStatement?(S=!0,e.push.apply(e,r(t.body))):t instanceof AST_EmptyStatement?S=!0:t instanceof AST_Directive?n.indexOf(t.value)<0?(e.push(t),n.push(t.value)):S=!0:e.push(t),e},[])}function a(e,t){var r=t.self(),a=r instanceof AST_Lambda,s=[];e:for(var f=e.length;--f>=0;){var u=e[f];switch(!0){case a&&u instanceof AST_Return&&!u.value&&0==s.length:S=!0;continue e;case u instanceof AST_If:if(u.body instanceof AST_Return){if((a&&0==s.length||s[0]instanceof AST_Return&&!s[0].value)&&!u.body.value&&!u.alternative){S=!0;var l=n(AST_SimpleStatement,u.condition,{body:u.condition});s.unshift(l);continue e}if(s[0]instanceof AST_Return&&u.body.value&&s[0].value&&!u.alternative){S=!0,u=u.clone(),u.alternative=s[0],s[0]=u.transform(t);continue e}if((0==s.length||s[0]instanceof AST_Return)&&u.body.value&&!u.alternative&&a){S=!0,u=u.clone(),u.alternative=s[0]||n(AST_Return,u,{value:n(AST_Undefined,u)}),s[0]=u.transform(t);continue e}if(!u.body.value&&a){S=!0,u=u.clone(),u.condition=u.condition.negate(t),u.body=n(AST_BlockStatement,u,{body:i(u.alternative).concat(s)}),u.alternative=null,s=[u.transform(t)];continue e}if(1==s.length&&a&&s[0]instanceof AST_SimpleStatement&&(!u.alternative||u.alternative instanceof AST_SimpleStatement)){S=!0,s.push(n(AST_Return,s[0],{value:n(AST_Undefined,s[0])}).transform(t)),s=i(u.alternative).concat(s),s.unshift(u);continue e}}var _=c(u.body),d=_ instanceof AST_LoopControl?t.loopcontrol_target(_.label):null;if(_&&(_ instanceof AST_Return&&!_.value&&a||_ instanceof AST_Continue&&r===o(d)||_ instanceof AST_Break&&d instanceof AST_BlockStatement&&r===d)){_.label&&remove(_.label.thedef.references,_.label),S=!0;var p=i(u.body).slice(0,-1);u=u.clone(),u.condition=u.condition.negate(t),u.body=n(AST_BlockStatement,u,{body:s}),u.alternative=n(AST_BlockStatement,u,{body:p}),s=[u.transform(t)];continue e}var _=c(u.alternative),d=_ instanceof AST_LoopControl?t.loopcontrol_target(_.label):null;if(_&&(_ instanceof AST_Return&&!_.value&&a||_ instanceof AST_Continue&&r===o(d)||_ instanceof AST_Break&&d instanceof AST_BlockStatement&&r===d)){_.label&&remove(_.label.thedef.references,_.label),S=!0,u=u.clone(),u.body=n(AST_BlockStatement,u.body,{body:i(u.body).concat(s)}),u.alternative=n(AST_BlockStatement,u.alternative,{body:i(u.alternative).slice(0,-1)}),s=[u.transform(t)];continue e}s.unshift(u);break;default:s.unshift(u)}}return s}function f(e,n){var t=!1,i=e.length,r=n.self();return e=e.reduce(function(e,i){if(t)s(n,i,e);else{if(i instanceof AST_LoopControl){var a=n.loopcontrol_target(i.label);i instanceof AST_Break&&a instanceof AST_BlockStatement&&o(a)===r||i instanceof AST_Continue&&o(a)===r?i.label&&remove(i.label.thedef.references,i.label):e.push(i)}else e.push(i);c(i)&&(t=!0)}return e},[]),S=e.length!=i,e}function u(e,t){function i(){r=AST_Seq.from_array(r),r&&o.push(n(AST_SimpleStatement,r,{body:r})),r=[]}if(e.length<2)return e;var r=[],o=[];return e.forEach(function(e){e instanceof AST_SimpleStatement?r.push(e.body):(i(),o.push(e))}),i(),o=l(o,t),S=o.length!=e.length,o}function l(e,t){function i(e){r.pop();var n=o.body;return n instanceof AST_Seq?n.add(e):n=AST_Seq.cons(n,e),n.transform(t)}var r=[],o=null;return e.forEach(function(e){if(o)if(e instanceof AST_For){var t={};try{o.body.walk(new TreeWalker(function(e){if(e instanceof AST_Binary&&"in"==e.operator)throw t})),!e.init||e.init instanceof AST_Definitions?e.init||(e.init=o.body,r.pop()):e.init=i(e.init)}catch(a){if(a!==t)throw a}}else e instanceof AST_If?e.condition=i(e.condition):e instanceof AST_With?e.expression=i(e.expression):e instanceof AST_Exit&&e.value?e.value=i(e.value):e instanceof AST_Exit?e.value=i(n(AST_Undefined,e)):e instanceof AST_Switch&&(e.expression=i(e.expression));r.push(e),o=e instanceof AST_SimpleStatement?e:null}),r}function _(e){var n=null;return e.reduce(function(e,t){return t instanceof AST_Definitions&&n&&n.TYPE==t.TYPE?(n.definitions=n.definitions.concat(t.definitions),S=!0):t instanceof AST_For&&n instanceof AST_Definitions&&(!t.init||t.init.TYPE==n.TYPE)?(S=!0,e.pop(),t.init?t.init.definitions=n.definitions.concat(t.init.definitions):t.init=n,e.push(t),n=t):(n=t,e.push(t)),e},[])}var S;do S=!1,e=r(e),t.option("dead_code")&&(e=f(e,t)),t.option("if_return")&&(e=a(e,t)),t.option("sequences")&&(e=u(e,t)),t.option("join_vars")&&(e=_(e,t));while(S);return e}function s(e,n,t){e.warn("Dropping unreachable code [{file}:{line},{col}]",n.start),n.walk(new TreeWalker(function(n){return n instanceof AST_Definitions?(e.warn("Declarations in unreachable code! [{file}:{line},{col}]",n.start),n.remove_initializers(),t.push(n),!0):n instanceof AST_Defun?(t.push(n),!0):n instanceof AST_Scope?!0:void 0}))}function f(e,n){return e.print_to_string().length>n.print_to_string().length?n:e}function c(e){return e&&e.aborts()}function u(e,t){function r(r){r=i(r),e.body instanceof AST_BlockStatement?(e.body=e.body.clone(),e.body.body=r.concat(e.body.body.slice(1)),e.body=e.body.transform(t)):e.body=n(AST_BlockStatement,e.body,{body:r}).transform(t),u(e,t)}var o=e.body instanceof AST_BlockStatement?e.body.body[0]:e.body;o instanceof AST_If&&(o.body instanceof AST_Break&&t.loopcontrol_target(o.body.label)===e?(e.condition=e.condition?n(AST_Binary,e.condition,{left:e.condition,operator:"&&",right:o.condition.negate(t)}):o.condition.negate(t),r(o.alternative)):o.alternative instanceof AST_Break&&t.loopcontrol_target(o.alternative.label)===e&&(e.condition=e.condition?n(AST_Binary,e.condition,{left:e.condition,operator:"&&",right:o.condition}):o.condition,r(o.body)))}function l(e,t){return t.option("booleans")&&t.in_boolean_context()?n(AST_True,e):e}e(AST_Node,function(e){return e}),AST_Node.DEFMETHOD("equivalent_to",function(e){return this.print_to_string()==e.print_to_string()}),function(e){var n=["!","delete"],t=["in","instanceof","==","!=","===","!==","<","<=",">=",">"];e(AST_Node,function(){return!1}),e(AST_UnaryPrefix,function(){return member(this.operator,n)}),e(AST_Binary,function(){return member(this.operator,t)||("&&"==this.operator||"||"==this.operator)&&this.left.is_boolean()&&this.right.is_boolean()}),e(AST_Conditional,function(){return this.consequent.is_boolean()&&this.alternative.is_boolean()}),e(AST_Assign,function(){return"="==this.operator&&this.right.is_boolean()}),e(AST_Seq,function(){return this.cdr.is_boolean()}),e(AST_True,function(){return!0}),e(AST_False,function(){return!0})}(function(e,n){e.DEFMETHOD("is_boolean",n)}),function(e){e(AST_Node,function(){return!1}),e(AST_String,function(){return!0}),e(AST_UnaryPrefix,function(){return"typeof"==this.operator}),e(AST_Binary,function(e){return"+"==this.operator&&(this.left.is_string(e)||this.right.is_string(e))}),e(AST_Assign,function(e){return("="==this.operator||"+="==this.operator)&&this.right.is_string(e)}),e(AST_Seq,function(e){return this.cdr.is_string(e)}),e(AST_Conditional,function(e){return this.consequent.is_string(e)&&this.alternative.is_string(e)}),e(AST_Call,function(e){return e.option("unsafe")&&this.expression instanceof AST_SymbolRef&&"String"==this.expression.name&&this.expression.undeclared()})}(function(e,n){e.DEFMETHOD("is_string",n)}),function(e){function n(e){return e._eval()}AST_Node.DEFMETHOD("evaluate",function(n){if(!n.option("evaluate"))return[this];try{var i=this._eval(),r=t(n,i,this);return[f(r,this),i]}catch(o){if(o!==e)throw o;return[this]}}),e(AST_Statement,function(){throw new Error(string_template("Cannot evaluate a statement [{file}:{line},{col}]",this.start))}),e(AST_Function,function(){return[this]}),e(AST_Node,function(){throw e}),e(AST_Constant,function(){return this.getValue()}),e(AST_UnaryPrefix,function(){var t=this.expression;switch(this.operator){case"!":return!n(t);case"typeof":if(t instanceof AST_Function)return"function";if(t=n(t),t instanceof RegExp)throw e;return typeof t;case"void":return void n(t);case"~":return~n(t);case"-":if(t=n(t),0===t)throw e;return-t;case"+":return+n(t)}throw e}),e(AST_Binary,function(){var t=this.left,i=this.right;switch(this.operator){case"&&":return n(t)&&n(i);case"||":return n(t)||n(i);case"|":return n(t)|n(i);case"&":return n(t)&n(i);case"^":return n(t)^n(i);case"+":return n(t)+n(i);case"*":return n(t)*n(i);case"/":return n(t)/n(i);case"%":return n(t)%n(i);case"-":return n(t)-n(i);case"<<":return n(t)<<n(i);case">>":return n(t)>>n(i);case">>>":return n(t)>>>n(i);case"==":return n(t)==n(i);case"===":return n(t)===n(i);case"!=":return n(t)!=n(i);case"!==":return n(t)!==n(i);case"<":return n(t)<n(i);case"<=":return n(t)<=n(i);case">":return n(t)>n(i);case">=":return n(t)>=n(i);case"in":return n(t)in n(i);case"instanceof":return n(t)instanceof n(i)}throw e}),e(AST_Conditional,function(){return n(this.condition)?n(this.consequent):n(this.alternative)}),e(AST_SymbolRef,function(){var t=this.definition();if(t&&t.constant&&t.init)return n(t.init);throw e})}(function(e,n){e.DEFMETHOD("_eval",n)}),function(e){function t(e){return n(AST_UnaryPrefix,e,{operator:"!",expression:e})}e(AST_Node,function(){return t(this)}),e(AST_Statement,function(){throw new Error("Cannot negate a statement")}),e(AST_Function,function(){return t(this)}),e(AST_UnaryPrefix,function(){return"!"==this.operator?this.expression:t(this)}),e(AST_Seq,function(e){var n=this.clone();return n.cdr=n.cdr.negate(e),n}),e(AST_Conditional,function(e){var n=this.clone();return n.consequent=n.consequent.negate(e),n.alternative=n.alternative.negate(e),f(t(this),n)}),e(AST_Binary,function(e){var n=this.clone(),i=this.operator;if(e.option("unsafe_comps"))switch(i){case"<=":return n.operator=">",n;case"<":return n.operator=">=",n;case">=":return n.operator="<",n;case">":return n.operator="<=",n}switch(i){case"==":return n.operator="!=",n;case"!=":return n.operator="==",n;case"===":return n.operator="!==",n;case"!==":return n.operator="===",n;case"&&":return n.operator="||",n.left=n.left.negate(e),n.right=n.right.negate(e),f(t(this),n);case"||":return n.operator="&&",n.left=n.left.negate(e),n.right=n.right.negate(e),f(t(this),n)}return t(this)})}(function(e,n){e.DEFMETHOD("negate",function(e){return n.call(this,e)})}),function(e){e(AST_Node,function(){return!0}),e(AST_EmptyStatement,function(){return!1}),e(AST_Constant,function(){return!1}),e(AST_This,function(){return!1}),e(AST_Block,function(){for(var e=this.body.length;--e>=0;)if(this.body[e].has_side_effects())return!0;return!1}),e(AST_SimpleStatement,function(){return this.body.has_side_effects()}),e(AST_Defun,function(){return!0}),e(AST_Function,function(){return!1}),e(AST_Binary,function(){return this.left.has_side_effects()||this.right.has_side_effects()}),e(AST_Assign,function(){return!0}),e(AST_Conditional,function(){return this.condition.has_side_effects()||this.consequent.has_side_effects()||this.alternative.has_side_effects()}),e(AST_Unary,function(){return"delete"==this.operator||"++"==this.operator||"--"==this.operator||this.expression.has_side_effects()}),e(AST_SymbolRef,function(){return!1}),e(AST_Object,function(){for(var e=this.properties.length;--e>=0;)if(this.properties[e].has_side_effects())return!0;return!1}),e(AST_ObjectProperty,function(){return this.value.has_side_effects()}),e(AST_Array,function(){for(var e=this.elements.length;--e>=0;)if(this.elements[e].has_side_effects())return!0;return!1}),e(AST_PropAccess,function(){return!0}),e(AST_Seq,function(){return this.car.has_side_effects()||this.cdr.has_side_effects()})}(function(e,n){e.DEFMETHOD("has_side_effects",n)}),function(e){function n(){var e=this.body.length;return e>0&&c(this.body[e-1])}e(AST_Statement,function(){return null}),e(AST_Jump,function(){return this}),e(AST_BlockStatement,n),e(AST_SwitchBranch,n),e(AST_If,function(){return this.alternative&&c(this.body)&&c(this.alternative)})}(function(e,n){e.DEFMETHOD("aborts",n)}),e(AST_Directive,function(e){return e.scope.has_directive(e.value)!==e.scope?n(AST_EmptyStatement,e):e}),e(AST_Debugger,function(e,t){return t.option("drop_debugger")?n(AST_EmptyStatement,e):e}),e(AST_LabeledStatement,function(e,t){return e.body instanceof AST_Break&&t.loopcontrol_target(e.body.label)===e.body?n(AST_EmptyStatement,e):0==e.label.references.length?e.body:e}),e(AST_Block,function(e,n){return e.body=a(e.body,n),e}),e(AST_BlockStatement,function(e,t){switch(e.body=a(e.body,t),e.body.length){case 1:return e.body[0];case 0:return n(AST_EmptyStatement,e)}return e}),AST_Scope.DEFMETHOD("drop_unused",function(e){var t=this;if(e.option("unused")&&!(t instanceof AST_Toplevel)&&!t.uses_eval){var i=[],r=new Dictionary,o=this,a=new TreeWalker(function(e,n){if(e!==t){if(e instanceof AST_Defun)return r.add(e.name.name,e),!0;if(e instanceof AST_Definitions&&o===t)return e.definitions.forEach(function(e){e.value&&(r.add(e.name.name,e.value),e.value.has_side_effects()&&e.value.walk(a))}),!0;if(e instanceof AST_SymbolRef)return push_uniq(i,e.definition()),!0;if(e instanceof AST_Scope){var s=o;return o=e,n(),o=s,!0}}});t.walk(a);for(var s=0;s<i.length;++s)i[s].orig.forEach(function(e){var n=r.get(e.name);n&&n.forEach(function(e){var n=new TreeWalker(function(e){e instanceof AST_SymbolRef&&push_uniq(i,e.definition())});e.walk(n)})});var f=new TreeTransformer(function(r,o,a){if(r instanceof AST_Lambda)for(var s=r.argnames,c=s.length;--c>=0;){var u=s[c];if(!u.unreferenced())break;s.pop(),e.warn("Dropping unused function argument {name} [{file}:{line},{col}]",{name:u.name,file:u.start.file,line:u.start.line,col:u.start.col})}if(r instanceof AST_Defun&&r!==t)return member(r.name.definition(),i)?r:(e.warn("Dropping unused function {name} [{file}:{line},{col}]",{name:r.name.name,file:r.name.start.file,line:r.name.start.line,col:r.name.start.col}),n(AST_EmptyStatement,r));if(r instanceof AST_Definitions&&!(f.parent()instanceof AST_ForIn)){var l=r.definitions.filter(function(n){if(member(n.name.definition(),i))return!0;var t={name:n.name.name,file:n.name.start.file,line:n.name.start.line,col:n.name.start.col};return n.value&&n.value.has_side_effects()?(n._unused_side_effects=!0,e.warn("Side effects in initialization of unused variable {name} [{file}:{line},{col}]",t),!0):(e.warn("Dropping unused variable {name} [{file}:{line},{col}]",t),!1)});l=mergeSort(l,function(e,n){return!e.value&&n.value?-1:!n.value&&e.value?1:0});for(var _=[],c=0;c<l.length;){var S=l[c];S._unused_side_effects?(_.push(S.value),l.splice(c,1)):(_.length>0&&(_.push(S.value),S.value=AST_Seq.from_array(_),_=[]),++c)}return _=_.length>0?n(AST_BlockStatement,r,{body:[n(AST_SimpleStatement,r,{body:AST_Seq.from_array(_)})]}):null,0!=l.length||_?0==l.length?_:(r.definitions=l,_&&(_.body.unshift(r),r=_),r):n(AST_EmptyStatement,r)}if(r instanceof AST_For&&r.init instanceof AST_BlockStatement){o(r,this);var d=r.init.body.slice(0,-1);return r.init=r.init.body.slice(-1)[0].body,d.push(r),a?MAP.splice(d):n(AST_BlockStatement,r,{body:d})}return r instanceof AST_Scope&&r!==t?r:void 0});t.transform(f)}}),AST_Scope.DEFMETHOD("hoist_declarations",function(e){var t=e.option("hoist_funs"),i=e.option("hoist_vars"),r=this;if(t||i){var o=[],a=[],s=new Dictionary,f=0,c=0;r.walk(new TreeWalker(function(e){return e instanceof AST_Scope&&e!==r?!0:e instanceof AST_Var?(++c,!0):void 0})),i=i&&c>1;var u=new TreeTransformer(function(e){if(e!==r){if(e instanceof AST_Directive)return o.push(e),n(AST_EmptyStatement,e);if(e instanceof AST_Defun&&t)return a.push(e),n(AST_EmptyStatement,e);if(e instanceof AST_Var&&i){e.definitions.forEach(function(e){s.set(e.name.name,e),++f});var c=e.to_assignments(),l=u.parent();return l instanceof AST_ForIn&&l.init===e?null==c?e.definitions[0].name:c:l instanceof AST_For&&l.init===e?c:c?n(AST_SimpleStatement,e,{body:c}):n(AST_EmptyStatement,e)}if(e instanceof AST_Scope)return e}});if(r=r.transform(u),f>0){var l=[];if(s.each(function(e,n){r instanceof AST_Lambda&&find_if(function(n){return n.name==e.name.name},r.argnames)?s.del(n):(e=e.clone(),e.value=null,l.push(e),s.set(n,e))}),l.length>0){for(var _=0;_<r.body.length;){if(r.body[_]instanceof AST_SimpleStatement){var S,d,p=r.body[_].body;if(p instanceof AST_Assign&&"="==p.operator&&(S=p.left)instanceof AST_Symbol&&s.has(S.name)){var T=s.get(S.name);if(T.value)break;T.value=p.right,remove(l,T),l.push(T),r.body.splice(_,1);continue}if(p instanceof AST_Seq&&(d=p.car)instanceof AST_Assign&&"="==d.operator&&(S=d.left)instanceof AST_Symbol&&s.has(S.name)){var T=s.get(S.name);if(T.value)break;T.value=d.right,remove(l,T),l.push(T),r.body[_].body=p.cdr;continue}}if(r.body[_]instanceof AST_EmptyStatement)r.body.splice(_,1);else{if(!(r.body[_]instanceof AST_BlockStatement))break;var h=[_,1].concat(r.body[_].body);r.body.splice.apply(r.body,h)}}l=n(AST_Var,r,{definitions:l}),a.push(l)}}r.body=o.concat(a,r.body)}return r}),e(AST_SimpleStatement,function(e,t){return t.option("side_effects")&&!e.body.has_side_effects()?(t.warn("Dropping side-effect-free statement [{file}:{line},{col}]",e.start),n(AST_EmptyStatement,e)):e}),e(AST_DWLoop,function(e,t){var i=e.condition.evaluate(t);if(e.condition=i[0],!t.option("loops"))return e;if(i.length>1){if(i[1])return n(AST_For,e,{body:e.body});if(e instanceof AST_While&&t.option("dead_code")){var r=[];return s(t,e.body,r),n(AST_BlockStatement,e,{body:r})}}return e}),e(AST_While,function(e,t){return t.option("loops")?(e=AST_DWLoop.prototype.optimize.call(e,t),e instanceof AST_While&&(u(e,t),e=n(AST_For,e,e).transform(t)),e):e}),e(AST_For,function(e,t){var i=e.condition;if(i&&(i=i.evaluate(t),e.condition=i[0]),!t.option("loops"))return e;if(i&&i.length>1&&!i[1]&&t.option("dead_code")){var r=[];return e.init instanceof AST_Statement?r.push(e.init):e.init&&r.push(n(AST_SimpleStatement,e.init,{body:e.init})),s(t,e.body,r),n(AST_BlockStatement,e,{body:r})}return u(e,t),e}),e(AST_If,function(e,t){if(!t.option("conditionals"))return e;var i=e.condition.evaluate(t);if(e.condition=i[0],i.length>1)if(i[1]){if(t.warn("Condition always true [{file}:{line},{col}]",e.condition.start),t.option("dead_code")){var o=[];return e.alternative&&s(t,e.alternative,o),o.push(e.body),n(AST_BlockStatement,e,{body:o}).transform(t)}}else if(t.warn("Condition always false [{file}:{line},{col}]",e.condition.start),t.option("dead_code")){var o=[];return s(t,e.body,o),e.alternative&&o.push(e.alternative),n(AST_BlockStatement,e,{body:o}).transform(t)}r(e.alternative)&&(e.alternative=null);var a=e.condition.negate(t),u=f(e.condition,a)===a;if(e.alternative&&u){u=!1,e.condition=a;var l=e.body;e.body=e.alternative||n(AST_EmptyStatement),e.alternative=l}if(r(e.body)&&r(e.alternative))return n(AST_SimpleStatement,e.condition,{body:e.condition}).transform(t);if(e.body instanceof AST_SimpleStatement&&e.alternative instanceof AST_SimpleStatement)return n(AST_SimpleStatement,e,{body:n(AST_Conditional,e,{condition:e.condition,consequent:e.body.body,alternative:e.alternative.body})}).transform(t);if(r(e.alternative)&&e.body instanceof AST_SimpleStatement)return u?n(AST_SimpleStatement,e,{body:n(AST_Binary,e,{operator:"||",left:a,right:e.body.body})}).transform(t):n(AST_SimpleStatement,e,{body:n(AST_Binary,e,{operator:"&&",left:e.condition,right:e.body.body})}).transform(t);if(e.body instanceof AST_EmptyStatement&&e.alternative&&e.alternative instanceof AST_SimpleStatement)return n(AST_SimpleStatement,e,{body:n(AST_Binary,e,{operator:"||",left:e.condition,right:e.alternative.body})}).transform(t);if(e.body instanceof AST_Exit&&e.alternative instanceof AST_Exit&&e.body.TYPE==e.alternative.TYPE)return n(e.body.CTOR,e,{value:n(AST_Conditional,e,{condition:e.condition,consequent:e.body.value||n(AST_Undefined,e.body).optimize(t),alternative:e.alternative.value||n(AST_Undefined,e.alternative).optimize(t)})}).transform(t);if(e.body instanceof AST_If&&!e.body.alternative&&!e.alternative&&(e.condition=n(AST_Binary,e.condition,{operator:"&&",left:e.condition,right:e.body.condition}).transform(t),e.body=e.body.body),c(e.body)&&e.alternative){var _=e.alternative;return e.alternative=null,n(AST_BlockStatement,e,{body:[e,_]}).transform(t)}if(c(e.alternative)){var S=e.body;return e.body=e.alternative,e.condition=u?a:e.condition.negate(t),e.alternative=null,n(AST_BlockStatement,e,{body:[e,S]}).transform(t)}return e}),e(AST_Switch,function(e,t){if(0==e.body.length&&t.option("conditionals"))return n(AST_SimpleStatement,e,{body:e.expression}).transform(t);for(;;){var i=e.body[e.body.length-1];if(i){var r=i.body[i.body.length-1];if(r instanceof AST_Break&&o(t.loopcontrol_target(r.label))===e&&i.body.pop(),i instanceof AST_Default&&0==i.body.length){e.body.pop();continue}}break}var a=e.expression.evaluate(t);e:if(2==a.length)try{if(e.expression=a[0],!t.option("dead_code"))break e;var s=a[1],f=!1,u=!1,l=!1,_=!1,S=!1,d=new TreeTransformer(function(i,r,o){if(i instanceof AST_Lambda||i instanceof AST_SimpleStatement)return i;if(i instanceof AST_Switch&&i===e)return i=i.clone(),r(i,this),S?i:n(AST_BlockStatement,i,{body:i.body.reduce(function(e,n){return e.concat(n.body)},[])}).transform(t);if(i instanceof AST_If||i instanceof AST_Try){var a=f;return f=!u,r(i,this),f=a,i}if(i instanceof AST_StatementWithBody||i instanceof AST_Switch){var a=u;return u=!0,r(i,this),u=a,i}if(i instanceof AST_Break&&this.loopcontrol_target(i.label)===e)return f?(S=!0,i):u?i:(_=!0,o?MAP.skip:n(AST_EmptyStatement,i));if(i instanceof AST_SwitchBranch&&this.parent()===e){if(_)return MAP.skip;if(i instanceof AST_Case){var d=i.expression.evaluate(t);if(d.length<2)throw e;return d[1]===s||l?(l=!0,c(i)&&(_=!0),r(i,this),i):MAP.skip}return r(i,this),i}});d.stack=t.stack.slice(),e=e.transform(d)}catch(p){if(p!==e)throw p}return e}),e(AST_Case,function(e,n){return e.body=a(e.body,n),e}),e(AST_Try,function(e,n){return e.body=a(e.body,n),e}),AST_Definitions.DEFMETHOD("remove_initializers",function(){this.definitions.forEach(function(e){e.value=null})}),AST_Definitions.DEFMETHOD("to_assignments",function(){var e=this.definitions.reduce(function(e,t){if(t.value){var i=n(AST_SymbolRef,t.name,t.name);e.push(n(AST_Assign,t,{operator:"=",left:i,right:t.value}))}return e},[]);return 0==e.length?null:AST_Seq.from_array(e)}),e(AST_Definitions,function(e){return 0==e.definitions.length?n(AST_EmptyStatement,e):e}),e(AST_Function,function(e,n){return e=AST_Lambda.prototype.optimize.call(e,n),n.option("unused")&&e.name&&e.name.unreferenced()&&(e.name=null),e}),e(AST_Call,function(e,t){if(t.option("unsafe")){var i=e.expression;if(i instanceof AST_SymbolRef&&i.undeclared())switch(i.name){case"Array":if(1!=e.args.length)return n(AST_Array,e,{elements:e.args});break;case"Object":if(0==e.args.length)return n(AST_Object,e,{properties:[]});break;case"String":return 0==e.args.length?n(AST_String,e,{value:""}):n(AST_Binary,e,{left:e.args[0],operator:"+",right:n(AST_String,e,{value:""})});case"Function":if(all(e.args,function(e){return e instanceof AST_String}))try{var r="(function("+e.args.slice(0,-1).map(function(e){return e.value}).join(",")+"){"+e.args[e.args.length-1].value+"})()",o=parse(r);o.figure_out_scope();var a=new Compressor(t.options);o=o.transform(a),o.figure_out_scope(),o.mangle_names();var s=o.body[0].body.expression,f=s.argnames.map(function(t,i){return n(AST_String,e.args[i],{value:t.print_to_string()})}),r=OutputStream();return AST_BlockStatement.prototype._codegen.call(s,s,r),r=r.toString().replace(/^\{|\}$/g,""),f.push(n(AST_String,e.args[e.args.length-1],{value:r})),e.args=f,e}catch(c){c instanceof JS_Parse_Error?(t.warn("Error parsing code passed to new Function [{file}:{line},{col}]",e.args[e.args.length-1].start),t.warn(c.toString())):console.log(c)}}else if(i instanceof AST_Dot&&"toString"==i.property&&0==e.args.length)return n(AST_Binary,e,{left:n(AST_String,e,{value:""}),operator:"+",right:i.expression}).transform(t)}return t.option("side_effects")&&e.expression instanceof AST_Function&&0==e.args.length&&!AST_Block.prototype.has_side_effects.call(e.expression)?n(AST_Undefined,e).transform(t):e}),e(AST_New,function(e,t){if(t.option("unsafe")){var i=e.expression;if(i instanceof AST_SymbolRef&&i.undeclared())switch(i.name){case"Object":case"RegExp":case"Function":case"Error":case"Array":return n(AST_Call,e,e).transform(t)}}return e}),e(AST_Seq,function(e,n){if(!n.option("side_effects"))return e;if(!e.car.has_side_effects()){var t;if(!(e.cdr instanceof AST_SymbolRef&&"eval"==e.cdr.name&&e.cdr.undeclared()&&(t=n.parent())instanceof AST_Call&&t.expression===e))return e.cdr}if(n.option("cascade")){if(e.car instanceof AST_Assign&&!e.car.left.has_side_effects()&&e.car.left.equivalent_to(e.cdr))return e.car;if(!e.car.has_side_effects()&&!e.cdr.has_side_effects()&&e.car.equivalent_to(e.cdr))return e.car}return e}),AST_Unary.DEFMETHOD("lift_sequences",function(e){if(e.option("sequences")&&this.expression instanceof AST_Seq){var n=this.expression,t=n.to_array();return this.expression=t.pop(),t.push(this),n=AST_Seq.from_array(t).transform(e)}return this}),e(AST_UnaryPostfix,function(e,n){return e.lift_sequences(n)}),e(AST_UnaryPrefix,function(e,t){e=e.lift_sequences(t);var i=e.expression;if(t.option("booleans")&&t.in_boolean_context()){switch(e.operator){case"!":if(i instanceof AST_UnaryPrefix&&"!"==i.operator)return i.expression;break;case"typeof":return t.warn("Boolean expression always true [{file}:{line},{col}]",e.start),n(AST_True,e)}i instanceof AST_Binary&&"!"==e.operator&&(e=f(e,i.negate(t)))}return e.evaluate(t)[0]}),AST_Binary.DEFMETHOD("lift_sequences",function(e){if(e.option("sequences")){if(this.left instanceof AST_Seq){var n=this.left,t=n.to_array();return this.left=t.pop(),t.push(this),n=AST_Seq.from_array(t).transform(e)}if(this.right instanceof AST_Seq&&"||"!=this.operator&&"&&"!=this.operator&&!this.left.has_side_effects()){var n=this.right,t=n.to_array();return this.right=t.pop(),t.push(this),n=AST_Seq.from_array(t).transform(e)}}return this});var _=makePredicate("== === != !== * & | ^");e(AST_Binary,function(e,t){function i(n,t){if(t||!e.left.has_side_effects()&&!e.right.has_side_effects()){n&&(e.operator=n);var i=e.left;e.left=e.right,e.right=i}}if(_(e.operator)&&e.right instanceof AST_Constant&&!(e.left instanceof AST_Constant)&&i(null,!0),e=e.lift_sequences(t),t.option("comparisons"))switch(e.operator){case"===":case"!==":(e.left.is_string(t)&&e.right.is_string(t)||e.left.is_boolean()&&e.right.is_boolean())&&(e.operator=e.operator.substr(0,2));case"==":case"!=":e.left instanceof AST_String&&"undefined"==e.left.value&&e.right instanceof AST_UnaryPrefix&&"typeof"==e.right.operator&&t.option("unsafe")&&(e.right.expression instanceof AST_SymbolRef&&e.right.expression.undeclared()||(e.right=e.right.expression,e.left=n(AST_Undefined,e.left).optimize(t),2==e.operator.length&&(e.operator+="=")))}if(t.option("booleans")&&t.in_boolean_context())switch(e.operator){case"&&":var r=e.left.evaluate(t),o=e.right.evaluate(t);if(r.length>1&&!r[1]||o.length>1&&!o[1])return t.warn("Boolean && always false [{file}:{line},{col}]",e.start),n(AST_False,e);if(r.length>1&&r[1])return o[0];if(o.length>1&&o[1])return r[0];break;case"||":var r=e.left.evaluate(t),o=e.right.evaluate(t);if(r.length>1&&r[1]||o.length>1&&o[1])return t.warn("Boolean || always true [{file}:{line},{col}]",e.start),n(AST_True,e);if(r.length>1&&!r[1])return o[0];if(o.length>1&&!o[1])return r[0];break;case"+":var r=e.left.evaluate(t),o=e.right.evaluate(t);if(r.length>1&&r[0]instanceof AST_String&&r[1]||o.length>1&&o[0]instanceof AST_String&&o[1])return t.warn("+ in boolean context always true [{file}:{line},{col}]",e.start),n(AST_True,e)}var a=e.evaluate(t);if(a.length>1&&f(a[0],e)!==e)return a[0];if(t.option("comparisons")){if(!(t.parent()instanceof AST_Binary)||t.parent()instanceof AST_Assign){var s=n(AST_UnaryPrefix,e,{operator:"!",expression:e.negate(t)});e=f(e,s)}switch(e.operator){case"<":i(">");break;case"<=":i(">=")}}return"+"==e.operator&&e.right instanceof AST_String&&""===e.right.getValue()&&e.left instanceof AST_Binary&&"+"==e.left.operator&&e.left.is_string(t)?e.left:e}),e(AST_SymbolRef,function(e,i){if(e.undeclared()){var r=i.option("global_defs");if(r&&r.hasOwnProperty(e.name))return t(i,r[e.name],e);switch(e.name){case"undefined":return n(AST_Undefined,e);case"NaN":return n(AST_NaN,e);case"Infinity":return n(AST_Infinity,e)}}return e}),e(AST_Undefined,function(e,t){if(t.option("unsafe")){var i=t.find_parent(AST_Scope),r=i.find_variable("undefined");if(r){var o=n(AST_SymbolRef,e,{name:"undefined",scope:i,thedef:r});return o.reference(),o}}return e});var S=["+","-","/","*","%",">>","<<",">>>","|","^","&"];e(AST_Assign,function(e,n){return e=e.lift_sequences(n),"="==e.operator&&e.left instanceof AST_SymbolRef&&e.right instanceof AST_Binary&&e.right.left instanceof AST_SymbolRef&&e.right.left.name==e.left.name&&member(e.right.operator,S)&&(e.operator=e.right.operator+"=",e.right=e.right.right),e}),e(AST_Conditional,function(e,t){if(!t.option("conditionals"))return e;if(e.condition instanceof AST_Seq){var i=e.condition.car;return e.condition=e.condition.cdr,AST_Seq.cons(i,e)}var r=e.condition.evaluate(t);if(r.length>1)return r[1]?(t.warn("Condition always true [{file}:{line},{col}]",e.start),e.consequent):(t.warn("Condition always false [{file}:{line},{col}]",e.start),e.alternative);var o=r[0].negate(t);f(r[0],o)===o&&(e=n(AST_Conditional,e,{condition:o,consequent:e.alternative,alternative:e.consequent}));var a=e.consequent,s=e.alternative;return a instanceof AST_Assign&&s instanceof AST_Assign&&a.operator==s.operator&&a.left.equivalent_to(s.left)&&(e=n(AST_Assign,e,{operator:a.operator,left:a.left,right:n(AST_Conditional,e,{condition:e.condition,consequent:a.right,alternative:s.right})})),e}),e(AST_Boolean,function(e,t){if(t.option("booleans")){var i=t.parent();return i instanceof AST_Binary&&("=="==i.operator||"!="==i.operator)?(t.warn("Non-strict equality against boolean: {operator} {value} [{file}:{line},{col}]",{operator:i.operator,value:e.value,file:i.start.file,line:i.start.line,col:i.start.col}),n(AST_Number,e,{value:+e.value})):n(AST_UnaryPrefix,e,{operator:"!",expression:n(AST_Number,e,{value:1-e.value})})
}return e}),e(AST_Sub,function(e,t){var i=e.property;return i instanceof AST_String&&t.option("properties")&&(i=i.getValue(),t.option("screw_ie8")&&RESERVED_WORDS(i)||!RESERVED_WORDS(i)&&is_identifier_string(i))?n(AST_Dot,e,{expression:e.expression,property:i}):e}),e(AST_Array,l),e(AST_Object,l),e(AST_RegExp,l)}();